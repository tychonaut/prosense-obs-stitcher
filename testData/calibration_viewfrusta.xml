<?xml version="1.0" ?>


<Cluster>
    
    <Stitching>
    
        <!-- All files are supposed to be specified relative to  this file's folder-->
    
    
        <!-- Maybe needed later...
        <Geometry
            type="dome"
            openingAngle_degrees="180.0"
            tilt_degrees="21.0"
            radius_meters="3.0"
        />
        -->
    
  
        <!-- ############################################################### -->
        <!-- Video sinks, i.e., the canvases; Yes, can be multiple, in principle -->
         <VideoSinks
            num="1"
         >
         
            <VideoSink
                index="0"
                name="MainCanvas"
                debug_renderScale="0.5"
                debug_backgroundImageName="fisheye_as_equirect_180_bourke.jpg"
            >
            

                
                <!-- alternative projections (not supported yet): 
                     "fisheye", "equi-angular-cubemap" 
                     (https://blog.google/products/google-ar-vr/bringing-pixels-front-and-center-vr-video/)
                -->
                <Projection
                    type="equirectangular"
                >
                    <!-- 
                        VIOSO has the euler angle convention 
                        "roll pitch yaw" ("zxy", "rotationMat = yawMat * pitchMat *  rollMat")
                        
                        How to interpret this orientation:
                        The goal is to re-parametrize the canvas of 
                        a full-sphere projection, so that the sub-canvas
                        filled by e.g. a 21°-tilted hemispheric dome
                        fills the canvas in a way that has desireable 
                        properties.
                        To stick with the above example: If the full 
                        spherical equirectangular canvas would have
                        a (virtual) resolution of 8k*4k, and if we would
                        encode  the dome image naively, 
                        most of the bottom half of the image is black, 
                        and the seam has a wave form due to the tilt.
                        In order to use hardware encoding of Nvidia GPUs
                        without issues (not all GPUs support more than
                        4k*4k resolution) and to save bandwidth,
                        the tilted dome could be encoded in the 
                        "left 4k*4k half of the virtual 8k*4k canvas.
                        Therefore, the whole scene (i.e. each frustum)
                        needs to be rotated by 
                        roll="90.0", pitch="0.0" yaw="21.0",
                        in order to yield a "left-only" hemisphere
                        only negative x values).
                        
                        *** IMPORTANT: The video *PLAYER* software needs
                        to be aware of this transformation and undo it! ***
                    -->
                    
                    <!-- axisConventions describe the rotation axes for the euler angles.
                        They can be 
                        DIN9300:  pitch axis = right, yaw axis = down, roll axis = front 
                        OpenGL:   pitch axis = right, yaw axis = up,   roll axis = back 
                   -->
                    <Orientation
                        type="euler_static_zxy"
                        axisConvention="DIN9300"
                        unit="degree"
                        roll="90.0"
                        pitch="0.0"
                        yaw="21.0"
                    />
                </Projection>
                
                <VirtualResolution
                    x="8192"
                    y="4096"
                />
                
                <!-- will yield actual canvas rendering, encoding and streaming resolution -->
                <CropRectangle
                    x_min="0"
                    y_min="0"
                    x_max="8192"
                    y_max="4096"
                />
                
            </VideoSink>
        
        </VideoSinks>    
        <!-- ############################################################### -->
        
        
        

        
        
        
        
        <!-- ############################################################### -->
        <!-- ############################################################### -->
        <VideoSources
            num="5" 
        >
        
            <!-- ########################################################### -->
            <Warping
                use="false"
                type="imageLUT2D"
                invert="true"
            />
            
            <Blending
                use="false"
                autoGenerate="false"
                fadingRange_pixels="200"
            />
            <!-- ########################################################### -->
        
        
            <VideoSource
                index="0"
                name="ArenaRT1"
                warpFileName="warpLUT_RT001.pfm"
                blendImageName="blendmask_RT001.png"
                testImageName="ParaView/RT001.png"
                decklinkWorkaround_verticalOffset_pixels="28"
            >        
                <Resolution x="2560" y="1600" /> 
                <Projection
                    type="planar"
                >
                    <Frustum>
                        <FOV
                            unit="degree"
                            up="41.00000"
                            down="41.00000"
                            left="55.00000"
                            right="55.00000"
                        />
                        
                        <!--
                        test/debug graphene:
                        
                        <Orientation
                            type="euler_static_zxy"
                            unit="degree"
                            roll="45.0"
                            pitch="0"
                            yaw="0"
                        />
                        
                        shall create a rotation matrix
                        that projects to the camera basis vectors,
                        where x' and y' are rotated 45° around z axis,
                        and z' unchanged (0 0 1)^T:
                        (x'^T 0.0)    (+0.7 +0.7 +0.0 +0.0)
                        (y'^T 0.0) =  (-0.7 +0.7 +0.0 +0.0)
                        (z'^T 0.0)    (+0.0 +0.0 +1.0 +0.0)
                        (0 ^T 1.0)    (+0.0 +0.0 +0.0 +1.0) 
                        
                        (CHECK)
                        
                        In column major notation, the following float-array
                        is expected:
                        +0.7 -0.7 +0.0 +0.0 | +0.7 +0.7 +0.0 +0.0 | +0.0 +0.0 +1.0  +0.0 | +0.0 +0.0 +0.0  +1.0 
                        
                        (CHECK after writing converter function that 
                        transposes row-major graphene matrix to 
                        to column major matrix, then grabs this
                        matrix as float array)
                        -->
                        
                        <Orientation
                            type="euler_static_zxy"
                            axisConvention="DIN9300"
                            unit="degree"
                            yaw="38.56322"
                            pitch="22.76471"
                            roll="-15.01428"
                        />
                    </Frustum>
                </Projection>
            </VideoSource>
            
            <VideoSource
                index="1"
                name="ArenaRT2"
                warpFileName="warpLUT_RT002.pfm"
                blendImageName="blendmask_RT002.png"
                testImageName="ParaView/RT002.png"
                decklinkWorkaround_verticalOffset_pixels="28"
            >        
                <Resolution x="2560" y="1600" /> 
                <Projection
                    type="planar"
                >
                    <Frustum>
                        <FOV
                            up="45.00000"
                            down="45.00000"
                            left="61.00000"
                            right="61.00000"
                        />
                        <Orientation
                            type="euler_static_zxy"
                            unit="degree"
                            yaw="-33.41741"
                            pitch="26.48922"
                            roll="15.66994"
                        />
                    </Frustum>
                </Projection>
            </VideoSource>
            
            <VideoSource
                index="2"
                name="ArenaRT3"
                warpFileName="warpLUT_RT003.pfm"
                blendImageName="blendmask_RT003.png"
                testImageName="ParaView/RT003.png"
                decklinkWorkaround_verticalOffset_pixels="28"
            >        
                <Resolution x="2560" y="1600" /> 
                <Projection
                    type="planar"
                >
                    <Frustum>
                        <FOV
                            up="42.00000"
                            down="42.00000"
                            left="58.00000"
                            right="58.00000"
                        />
                        <Orientation
                            type="euler_static_zxy"
                            axisConvention="DIN9300"
                            unit="degree"
                            yaw="-116.45371"
                            pitch="52.31257"
                            roll="25.71614"
                        />
                    </Frustum>
                </Projection>
            </VideoSource>
            
            <VideoSource
                index="3"
                name="ArenaRT4"
                warpFileName="warpLUT_RT004.pfm"
                blendImageName="blendmask_RT004.png"
                testImageName="ParaView/RT004.png"
                decklinkWorkaround_verticalOffset_pixels="28"
            >        
                <Resolution x="2560" y="1600" /> 
                <Projection
                    type="planar"
                >
                    <Frustum>
                        <FOV
                            up="44.00000"
                            down="44.00000"
                            left="55.00000"
                            right="55.00000"
                        />
                        <Orientation
                            type="euler_static_zxy"
                            axisConvention="DIN9300"
                            unit="degree"
                            yaw="115.04663"
                            pitch="53.06412"
                            roll="-28.08995"
                        />
                    </Frustum>
                </Projection>
            </VideoSource>
            
            <VideoSource
                index="4"
                name="ArenaRT5"
                warpFileName="warpLUT_RT005.pfm"
                blendImageName="blendmask_RT005.png"
                testImageName="ParaView/RT005.png"
                decklinkWorkaround_verticalOffset_pixels="28"
            >        
                <Resolution x="2560" y="1600" /> 
                <Projection
                    type="planar"
                >
                    <Frustum>
                        <FOV
                            up="43.00000"
                            down="43.00000"
                            left="57.00000"
                            right="57.00000"
                        />
                        <Orientation
                            type="euler_static_zxy"
                            axisConvention="DIN9300"
                            unit="degree"
                            yaw="-6.74970"
                            pitch="72.18367"
                            roll="4.26111"
                        />
                    </Frustum>
                </Projection>
            </VideoSource>
            
        </VideoSources>
        <!-- ############################################################### -->
        <!-- ############################################################### -->
        
    </Stitching>
    

</Cluster>